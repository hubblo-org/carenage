ARG PORT=5173

FROM node:22-alpine AS builder 

LABEL org.opencontainers.image.authors="contact@hubblo.org"
LABEL org.opencontainers.image.description="Docker image for the dashboard for metrics generated by Carenage, a CI tool for environmental evaluation of software projects"
LABEL org.opencontainers.image.licenses=Apache-2.0
LABEL org.opencontainers.image.title="carenage-dashboard"

WORKDIR /dashboard
COPY package.json package-lock.json .
RUN npm ci 
COPY . .
RUN npm run build
RUN npm prune --production

FROM node:22-alpine AS runtime

WORKDIR /dashboard
COPY --from=builder /dashboard/build build/ 
COPY --from=builder /dashboard/node_modules node_modules/
COPY package.json .
EXPOSE $PORT
ENV NODE_ENV=production
CMD ["node", "build"]
